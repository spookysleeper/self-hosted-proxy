# Main OpenResty configuration
worker_processes 1;
error_log logs/error.log info;

events {
    worker_connections 1024;
}

http {
    include mime.types;
    default_type application/octet-stream;

    sendfile on;
    keepalive_timeout 65;

    # Access log
    access_log logs/access.log;

    # Lua package path for custom modules
    lua_package_path "./openresty/lua/?.lua;;";
    
    # WebSocket support - map Connection header
    map $http_upgrade $connection_upgrade {
        default upgrade;
        '' close;
    }

    # Include site configurations
    include conf.d/sites/*.conf;
}