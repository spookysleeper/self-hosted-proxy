server {
    listen 8080;
    server_name localhost;

    # Serve static assets (built JS libraries)
    location /assets/ {
        alias public/assets/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Test endpoint
    location /test {
        content_by_lua_block {
            ngx.say("Hello, OpenResty is working!")
        }
    }

    # Proxy to upstream and inject JavaScript
    location / {
        # Example: proxy to another service
        # proxy_pass http://upstream-service:3000;
        
        # For demo purposes, return a simple HTML page
        content_by_lua_block {
            ngx.header.content_type = "text/html"
            ngx.say([[
<!DOCTYPE html>
<html>
<head>
    <title>Test Page</title>
</head>
<body>
    <h1>Hello from proxied content</h1>
    <p>JavaScript will be injected here by OpenResty</p>
</body>
</html>
            ]])
        }

        # Enable body filtering to inject scripts
        body_filter_by_lua_file openresty/lua/inject.lua;
    }
}
